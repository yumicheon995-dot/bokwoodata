// === 설정 ===
const SHEET_ID   = '여기에_시트_ID_붙여넣기';  // 예: 1AbCdEfGh... 
const SHEET_NAME = '시트1';                       // 시트 이름

function getSheet(){
  const ss = SpreadsheetApp.openById(SHEET_ID);
  return ss.getSheetByName(SHEET_NAME) || ss.getActiveSheet();
}

function doPost(e){
  const sh = getSheet();
  const p  = e.parameter;

  // 시트 기록
  sh.appendRow([
    new Date(), p.name||'', p.phone||'', p.period||'', p.sales||'', p.memo||'',
    p.utm_source||'', p.utm_medium||'', p.utm_campaign||'', p.referrer||'', p.user_agent||'', p.page_url||''
  ]);

  // 이메일 알림
  const to = (p.notify||'').trim();
  if (to) {
    const subject = `새 상담 신청: ${p.name||''} / ${p.phone||''}`;
    const html = `<h3>새 상담 신청</h3>
      <table border=0 cellpadding=6>
        <tr><td><b>이름</b></td><td>${p.name||''}</td></tr>
        <tr><td><b>전화</b></td><td>${p.phone||''}</td></tr>
        <tr><td><b>사업 기간</b></td><td>${p.period||''}</td></tr>
        <tr><td><b>최근 3개월 매출</b></td><td>${p.sales||''}</td></tr>
        <tr><td><b>메모</b></td><td>${(p.memo||'').replace(/\n/g,'<br>')}</td></tr>
        <tr><td><b>페이지</b></td><td>${p.page_url||''}</td></tr>
        <tr><td><b>Referrer</b></td><td>${p.referrer||''}</td></tr>
        <tr><td><b>UA</b></td><td>${p.user_agent||''}</td></tr>
      </table>`;
    MailApp.sendEmail({ to, subject, htmlBody: html });
  }
  return ContentService.createTextOutput('OK');
}

function doGet(){
  return ContentService.createTextOutput('READY');
}

// (선택) 권한 승인 테스트용
function testMail(){
  MailApp.sendEmail('yumicheon@gmail.com', '테스트', '메일 전송 OK');
}
